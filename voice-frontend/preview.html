<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>Voice Preview</title>
    <style>
      body {
        font-family: system-ui;
        padding: 40px;
        text-align: center;
      }
      h1 {
        margin-bottom: 20px;
      }
      audio {
        margin-top: 30px;
      }
    </style>
  </head>
  <body>
    <h1 id="title">Voice Preview</h1>
    <p id="loading">Generating preview...</p>
    <audio id="player" controls></audio>

    <script>
      const API_BASE = "http://localhost:3000";

      const url = new URL(window.location.href);
      const voice = url.searchParams.get("voice");
      const name = url.searchParams.get("name") || "你";

      document.getElementById("title").textContent =
        `preview：${voice}`;

      async function loadPreview() {
        const res = await fetch(
          `${API_BASE}/voice/sample?voice=${voice}&name=${name}`
        );

        const data = await res.json();

        const audioBase64 = data.audioBase64;

        const blob = base64ToBlob(audioBase64, "audio/mpeg");
        const url = URL.createObjectURL(blob);

        const player = document.getElementById("player");
        player.src = url;
        player.play();

        document.getElementById("loading").textContent = "The preview has been loaded.";
      }

      function base64ToBlob(base64, contentType) {
        const byteCharacters = atob(base64);
        const byteNumbers = [];
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers.push(byteCharacters.charCodeAt(i));
        }
        const byteArray = new Uint8Array(byteNumbers);
        return new Blob([byteArray], { type: contentType });
      }

      loadPreview();
    </script>
  </body>
</html>
